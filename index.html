<h1>Type families to break code</h1>

<h2>Context</h2>

<p>Lately I'm working on a project of mine <em>mootzoo</em>. It's a REST server on a sqlite DB and it happens the protocol is growing. </p>

<p>I splitted the protocol in half. Put requests and Get requests. Put requests are easier as they return (), letting aside the failures which are not in the type.</p>

<p>Easy like</p>

<pre><code>data Put
    = Boot Mail String  
    | Invite Login Mail String
    | Logout Login String
    | Reminds Mail String
    | Migrate Login Mail String
    | New Login Attach String
    | Retract Login MessageId
    | Leave Login Dispose MessageId
    | Vote Login MessageId Bool
    .....
</code></pre>

<p>Well, it happened I added some more features, and I'm not sure this is over.</p>

<p>The main point here is that each module now exports some functions which we can simplify being in IO.</p>

<p>module <em>Users</em> exporting </p>

<pre><code>boot :: Mail -&gt; String -&gt; IO ()
invite :: Login -&gt; Mail -&gt; String -&gt; IO ()
...
</code></pre>

<p>module <em>Messages</em> exporting</p>

<pre><code>new :: Login -&gt; Mail -&gt; String -&gt; IO ()
...
</code></pre>

<p>module <em>Voting</em> exporting</p>

<pre><code>vote :: Login -&gt; MessageId -&gt; Bool -&gt; IO ()
</code></pre>

<p>Back to module <em>Protocol</em>  which implements the big</p>

<pre><code>Put -&gt; IO ()
</code></pre>

<p>importing all necessary functions from the other modules.</p>
